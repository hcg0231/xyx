<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本与二进制互转工具</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-height {
                transition: max-height 0.5s ease-in-out;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .tab-active {
                @apply bg-primary text-white;
            }
            .tab-inactive {
                @apply bg-slate-200 text-slate-700 hover:bg-slate-300;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 页面标题 -->
        <header class="text-center mb-12 mt-6">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary text-shadow mb-3">
                <i class="fa fa-exchange mr-3"></i>文本与二进制互转工具
            </h1>
            <p class="text-slate-600 max-w-2xl mx-auto">
                在文本和二进制表示之间进行双向转换，支持所有Unicode字符
            </p>
        </header>
        
        <!-- 主内容区 -->
        <main class="bg-white rounded-2xl shadow-xl overflow-hidden transform transition-all duration-300 hover:shadow-2xl">
            <!-- 转换模式选择 -->
            <div class="flex border-b border-slate-100">
                <button 
                    id="text-to-binary-tab" 
                    class="flex-1 py-4 px-6 font-medium tab-active transition-all"
                >
                    <i class="fa fa-font mr-2"></i>文本转二进制
                </button>
                <button 
                    id="binary-to-text-tab" 
                    class="flex-1 py-4 px-6 font-medium tab-inactive transition-all"
                >
                    <i class="fa fa-code mr-2"></i>二进制转文本
                </button>
            </div>
            
            <!-- 输入区域 -->
            <div class="p-6 md:p-8 border-b border-slate-100">
                <label for="input-data" class="block text-sm font-medium text-slate-700 mb-2">
                    <i class="fa fa-pencil-square-o mr-1"></i><span id="input-label">输入文本</span>
                </label>
                <textarea 
                    id="input-data" 
                    rows="5" 
                    class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none resize-none"
                    placeholder="请输入要转换的文本..."></textarea>
                
                <div class="flex flex-wrap gap-3 mt-4">
                    <button 
                        id="convert-btn" 
                        class="px-6 py-2.5 bg-primary text-white rounded-lg shadow hover:bg-primary/90 active:bg-primary/80 transition-all flex items-center justify-center"
                    >
                        <i class="fa fa-magic mr-2"></i><span id="convert-btn-text">转换为二进制</span>
                    </button>
                    <button 
                        id="clear-btn" 
                        class="px-6 py-2.5 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 active:bg-slate-400 transition-all flex items-center justify-center"
                    >
                        <i class="fa fa-trash mr-2"></i>清空
                    </button>
                    <button 
                        id="copy-btn" 
                        class="px-6 py-2.5 bg-secondary text-white rounded-lg shadow hover:bg-secondary/90 active:bg-secondary/80 transition-all flex items-center justify-center ml-auto"
                        disabled
                    >
                        <i class="fa fa-copy mr-2"></i>复制结果
                    </button>
                </div>
            </div>
            
            <!-- 结果区域 -->
            <div id="result-container" class="p-6 md:p-8 bg-slate-50 max-h-0 overflow-hidden transition-height">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-semibold text-slate-800">
                        <i class="fa fa-code mr-2"></i><span id="result-label">转换结果 (二进制)</span>
                    </h2>
                    <span id="char-count" class="text-sm text-slate-500">
                        字符数: 0
                    </span>
                </div>
                
                <div id="result-content" class="bg-dark text-green-400 p-4 rounded-lg font-mono text-sm md:text-base overflow-x-auto max-h-64">
                    <pre id="conversion-result" class="whitespace-pre-wrap break-all"></pre>
                </div>
            </div>
            
            <!-- 信息提示区 -->
            <div class="p-4 bg-blue-50 border-t border-blue-100 hidden" id="info-toast">
                <div class="flex items-center">
                    <i class="fa fa-info-circle text-blue-500 mr-2"></i>
                    <p class="text-sm text-blue-700" id="info-message"></p>
                </div>
            </div>
            
            <!-- 错误提示区 -->
            <div class="p-4 bg-red-50 border-t border-red-100 hidden" id="error-toast">
                <div class="flex items-center">
                    <i class="fa fa-exclamation-circle text-red-500 mr-2"></i>
                    <p class="text-sm text-red-700" id="error-message"></p>
                </div>
            </div>
        </main>
        
        <!-- 说明部分 -->
        <section class="mt-10 bg-white rounded-xl shadow p-6">
            <h2 class="text-xl font-semibold mb-4 text-slate-800">
                <i class="fa fa-lightbulb-o mr-2"></i>关于文本与二进制转换
            </h2>
            <div class="text-slate-600 space-y-3 text-sm md:text-base">
                <p>计算机使用二进制（0和1）来存储和处理所有信息。每个字符都有其对应的二进制表示。</p>
                <p>本工具支持双向转换：</p>
                <ul class="list-disc list-inside ml-2 space-y-1">
                    <li>文本转二进制：将每个字符转换为其UTF-8编码的二进制表示</li>
                    <li>二进制转文本：将UTF-8编码的二进制字符串转换回原始文本</li>
                </ul>
                <p>例如，字符"A"的二进制表示为"01000001"，字符"中"的二进制表示为"11100100 10111000 10101101"。</p>
                <p class="text-amber-700 bg-amber-50 p-2 rounded"><i class="fa fa-info-circle mr-1"></i> 二进制转文本时，请确保输入的是有效的二进制字符串，以空格分隔每个字节。</p>
            </div>
        </section>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-slate-500 text-sm">
            <p>© 2023 文本与二进制互转工具 | 一个简单实用的工具</p>
        </footer>
    </div>

    <script>
        // 获取DOM元素
        const inputData = document.getElementById('input-data');
        const convertBtn = document.getElementById('convert-btn');
        const clearBtn = document.getElementById('clear-btn');
        const copyBtn = document.getElementById('copy-btn');
        const conversionResult = document.getElementById('conversion-result');
        const resultContainer = document.getElementById('result-container');
        const charCount = document.getElementById('char-count');
        const infoToast = document.getElementById('info-toast');
        const infoMessage = document.getElementById('info-message');
        const errorToast = document.getElementById('error-toast');
        const errorMessage = document.getElementById('error-message');
        const inputLabel = document.getElementById('input-label');
        const resultLabel = document.getElementById('result-label');
        const convertBtnText = document.getElementById('convert-btn-text');
        const textToBinaryTab = document.getElementById('text-to-binary-tab');
        const binaryToTextTab = document.getElementById('binary-to-text-tab');
        
        // 转换模式：true为文本转二进制，false为二进制转文本
        let isTextToBinary = true;
        
        // 文本转二进制函数
        function textToBinary(text) {
            if (!text) return '';
            
            const binaryArray = [];
            for (let i = 0; i < text.length; i++) {
                // 获取字符的Unicode编码
                const code = text.charCodeAt(i);
                // 转换为二进制，处理多字节字符
                let binary = '';
                if (code <= 0x7F) {
                    binary = code.toString(2).padStart(8, '0');
                } else {
                    // 对于超过ASCII范围的字符，使用UTF-8编码的二进制表示
                    let utf8 = unescape(encodeURIComponent(text[i]));
                    for (let j = 0; j < utf8.length; j++) {
                        binary += utf8.charCodeAt(j).toString(2).padStart(8, '0') + ' ';
                    }
                    binary = binary.trim();
                }
                binaryArray.push(binary);
            }
            return binaryArray.join(' ');
        }
        
        // 二进制转文本函数
        function binaryToText(binary) {
            if (!binary) return '';
            
            try {
                // 分割二进制字符串为字节数组
                const bytes = binary.split(/\s+/);
                let utf8Bytes = [];
                
                // 转换每个二进制字节为十进制
                for (let i = 0; i < bytes.length; i++) {
                    // 验证二进制格式
                    if (!/^[01]{8}$/.test(bytes[i])) {
                        throw new Error(`无效的二进制格式: "${bytes[i]}", 每个字节必须是8位0和1的组合`);
                    }
                    utf8Bytes.push(parseInt(bytes[i], 2));
                }
                
                // 将字节数组转换为UTF-8文本
                let text = '';
                let i = 0;
                while (i < utf8Bytes.length) {
                    let codePoint;
                    const byte1 = utf8Bytes[i];
                    
                    // 单字节字符 (0xxxxxxx)
                    if ((byte1 & 0x80) === 0) {
                        codePoint = byte1;
                        i++;
                    }
                    // 双字节字符 (110xxxxx 10xxxxxx)
                    else if ((byte1 & 0xE0) === 0xC0) {
                        const byte2 = utf8Bytes[i + 1];
                        if ((byte2 & 0xC0) !== 0x80) throw new Error("无效的UTF-8编码");
                        codePoint = ((byte1 & 0x1F) << 6) | (byte2 & 0x3F);
                        i += 2;
                    }
                    // 三字节字符 (1110xxxx 10xxxxxx 10xxxxxx)
                    else if ((byte1 & 0xF0) === 0xE0) {
                        const byte2 = utf8Bytes[i + 1];
                        const byte3 = utf8Bytes[i + 2];
                        if ((byte2 & 0xC0) !== 0x80 || (byte3 & 0xC0) !== 0x80) throw new Error("无效的UTF-8编码");
                        codePoint = ((byte1 & 0x0F) << 12) | ((byte2 & 0x3F) << 6) | (byte3 & 0x3F);
                        i += 3;
                    }
                    // 四字节字符 (11110xxx 10xxxxxx 10xxxxxx 10xxxxxx)
                    else if ((byte1 & 0xF8) === 0xF0) {
                        const byte2 = utf8Bytes[i + 1];
                        const byte3 = utf8Bytes[i + 2];
                        const byte4 = utf8Bytes[i + 3];
                        if ((byte2 & 0xC0) !== 0x80 || (byte3 & 0xC0) !== 0x80 || (byte4 & 0xC0) !== 0x80) throw new Error("无效的UTF-8编码");
                        codePoint = ((byte1 & 0x07) << 18) | ((byte2 & 0x3F) << 12) | ((byte3 & 0x3F) << 6) | (byte4 & 0x3F);
                        i += 4;
                    } else {
                        throw new Error("无效的UTF-8起始字节");
                    }
                    
                    text += String.fromCodePoint(codePoint);
                }
                
                return text;
            } catch (error) {
                throw error;
            }
        }
        
        // 显示提示信息
        function showInfo(message, duration = 3000) {
            hideAllToasts();
            infoMessage.textContent = message;
            infoToast.classList.remove('hidden');
            
            setTimeout(() => {
                infoToast.classList.add('hidden');
            }, duration);
        }
        
        // 显示错误信息
        function showError(message, duration = 5000) {
            hideAllToasts();
            errorMessage.textContent = message;
            errorToast.classList.remove('hidden');
            
            setTimeout(() => {
                errorToast.classList.add('hidden');
            }, duration);
        }
        
        // 隐藏所有提示
        function hideAllToasts() {
            infoToast.classList.add('hidden');
            errorToast.classList.add('hidden');
        }
        
        // 切换转换模式
        function switchMode(mode) {
            isTextToBinary = mode;
            
            // 更新UI
            if (isTextToBinary) {
                // 文本转二进制模式
                textToBinaryTab.classList.remove('tab-inactive');
                textToBinaryTab.classList.add('tab-active');
                binaryToTextTab.classList.remove('tab-active');
                binaryToTextTab.classList.add('tab-inactive');
                
                inputLabel.textContent = '输入文本';
                resultLabel.textContent = '转换结果 (二进制)';
                convertBtnText.textContent = '转换为二进制';
                inputData.placeholder = '请输入要转换的文本...';
                inputData.classList.remove('font-mono');
            } else {
                // 二进制转文本模式
                binaryToTextTab.classList.remove('tab-inactive');
                binaryToTextTab.classList.add('tab-active');
                textToBinaryTab.classList.remove('tab-active');
                textToBinaryTab.classList.add('tab-inactive');
                
                inputLabel.textContent = '输入二进制';
                resultLabel.textContent = '转换结果 (文本)';
                convertBtnText.textContent = '转换为文本';
                inputData.placeholder = '请输入要转换的二进制，以空格分隔每个字节...';
                inputData.classList.add('font-mono', 'text-sm');
            }
            
            // 清空输入和结果
            clearAll();
        }
        
        // 清空所有内容
        function clearAll() {
            inputData.value = '';
            conversionResult.textContent = '';
            resultContainer.style.maxHeight = '0';
            copyBtn.disabled = true;
            inputData.focus();
            hideAllToasts();
        }
        
        // 转换按钮点击事件
        convertBtn.addEventListener('click', () => {
            const input = inputData.value.trim();
            
            if (!input) {
                showInfo(isTextToBinary ? '请输入要转换的文本' : '请输入要转换的二进制');
                return;
            }
            
            try {
                // 根据当前模式执行相应转换
                let result;
                if (isTextToBinary) {
                    result = textToBinary(input);
                } else {
                    result = binaryToText(input);
                }
                
                // 显示结果
                conversionResult.textContent = result;
                charCount.textContent = `字符数: ${result.length}`;
                
                // 显示结果区域（带动画）
                resultContainer.style.maxHeight = '500px';
                
                // 启用复制按钮
                copyBtn.disabled = false;
                
                // 添加转换成功的动画效果
                convertBtn.classList.add('bg-green-500');
                convertBtn.innerHTML = `<i class="fa fa-check mr-2"></i>转换完成`;
                
                setTimeout(() => {
                    convertBtn.classList.remove('bg-green-500');
                    convertBtn.innerHTML = `<i class="fa fa-magic mr-2"></i>${convertBtnText.textContent}`;
                }, 1500);
                
            } catch (error) {
                // 显示错误信息
                showError(error.message);
                console.error('转换错误:', error);
            }
        });
        
        // 清空按钮点击事件
        clearBtn.addEventListener('click', () => {
            clearAll();
            showInfo('已清空输入');
        });
        
        // 复制按钮点击事件
        copyBtn.addEventListener('click', () => {
            if (conversionResult.textContent) {
                navigator.clipboard.writeText(conversionResult.textContent)
                    .then(() => {
                        showInfo('结果已复制到剪贴板');
                        // 复制成功的动画效果
                        copyBtn.classList.add('bg-green-600');
                        copyBtn.innerHTML = '<i class="fa fa-check mr-2"></i>已复制';
                        
                        setTimeout(() => {
                            copyBtn.classList.remove('bg-green-600');
                            copyBtn.innerHTML = '<i class="fa fa-copy mr-2"></i>复制结果';
                        }, 1500);
                    })
                    .catch(err => {
                        showError('复制失败，请手动复制');
                        console.error('复制失败:', err);
                    });
            }
        });
        
        // 切换到文本转二进制模式
        textToBinaryTab.addEventListener('click', () => {
            if (!isTextToBinary) {
                switchMode(true);
            }
        });
        
        // 切换到二进制转文本模式
        binaryToTextTab.addEventListener('click', () => {
            if (isTextToBinary) {
                switchMode(false);
            }
        });
        
        // 输入框事件监听
        inputData.addEventListener('input', () => {
            hideAllToasts();
        });
        
        // 页面加载完成后聚焦到输入框
        window.addEventListener('load', () => {
            inputData.focus();
        });
    </script>
</body>
</html>
    